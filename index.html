<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quiz Login and Start</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">

  <!-- Login Page (Name and Email) -->
  <div id="loginPage" class="max-w-xl mx-auto space-y-8 bg-white p-6 rounded-xl shadow-md">
    <h2 class="text-2xl font-bold mb-4">üßë‚Äçüéì Participant Login</h2>
    <input type="text" id="name" placeholder="Enter Your Name" class="border rounded px-3 py-2 w-full mb-3" required>
    <input type="email" id="email" placeholder="Enter Your Email" class="border rounded px-3 py-2 w-full mb-3" required>
    <button onclick="startQuiz()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full">Start Quiz</button>
  </div>

  <!-- Quiz Page (After Login) -->
  <div id="quizPage" class="hidden">
    <h2 class="text-2xl font-bold mb-4">üìù Quiz</h2>
    <div id="questionContainer"></div>
    <div id="timer" class="text-red-500 font-semibold mb-4"></div>
    <button id="nextBtn" onclick="nextQuestion()" class="bg-blue-500 text-white px-4 py-2 rounded-xl hover:bg-blue-600 disabled:opacity-50" disabled>Next</button>
  </div>

  <script>
    // Sample Questions and Options
    const questions = [
      {
        text: "What is the capital of France?",
        time: 30,
        options: [
          { text: "Paris", marks: 5 },
          { text: "Madrid", marks: 0 },
          { text: "Berlin", marks: 0 },
          { text: "Rome", marks: 0 }
        ]
      },
      {
        text: "2 + 2 = ?",
        time: 30,
        options: [
          { text: "3", marks: 0 },
          { text: "4", marks: 2 },
          { text: "5", marks: 0 },
          { text: "6", marks: 0 }
        ]
      },
      {
        text: "Who wrote '1984'?",
        time: 30,
        options: [
          { text: "George Orwell", marks: 3 },
          { text: "Mark Twain", marks: 0 },
          { text: "Hemingway", marks: 0 },
          { text: "Fitzgerald", marks: 0 }
        ]
      }
    ];

    let currentQuestion = 0;
    let totalScore = 0;
    let timeLeft = 0;
    let timerInterval;
    let name, email;

    // Start Quiz - Save Participant's Name and Email, then Redirect to Quiz Page
    function startQuiz() {
      name = document.getElementById('name').value;
      email = document.getElementById('email').value;

      if (!name || !email) {
        alert('Please fill in your name and email.');
        return;
      }

      // Store participant's data for later
      sessionStorage.setItem('name', name);
      sessionStorage.setItem('email', email);

      // Hide login page, show quiz page
      document.getElementById('loginPage').classList.add('hidden');
      document.getElementById('quizPage').classList.remove('hidden');

      showQuestion(currentQuestion);
    }

    // Display Question and Options
    function showQuestion(index) {
      clearInterval(timerInterval);
      const q = questions[index];
      document.getElementById('questionContainer').innerHTML = `
        <h3 class="text-lg font-semibold mb-2">${q.text}</h3>
        <div id="options" class="space-y-2 mb-4"></div>
      `;

      const optionsDiv = document.getElementById("options");
      q.options.forEach((opt, i) => {
        const label = document.createElement("label");
        label.className = "block px-4 py-2 border rounded hover:bg-gray-100 cursor-pointer";
        label.innerHTML = `<input type="radio" name="option" value="${i}" class="mr-2"> ${opt.text}`;
        label.querySelector("input").addEventListener("change", () => {
          document.getElementById("nextBtn").disabled = false;
        });
        optionsDiv.appendChild(label);
      });

      timeLeft = q.time;
      document.getElementById('timer').textContent = `‚è≥ Time left: ${timeLeft}s`;
      
      timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').textContent = `‚è≥ Time left: ${timeLeft}s`;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          nextQuestion(true); // auto-submit if time runs out
        }
      }, 1000);
    }

    // Move to Next Question
    function nextQuestion(auto = false) {
      const selected = document.querySelector('input[name="option"]:checked');
      const selectedIndex = selected ? parseInt(selected.value) : null;
      const q = questions[currentQuestion];

      if (selectedIndex !== null) {
        totalScore += q.options[selectedIndex].marks;
      }

      currentQuestion++;
      if (currentQuestion < questions.length) {
        showQuestion(currentQuestion);
      } else {
        endQuiz();
      }
    }

    // End Quiz and Submit Data to Google Sheets
    function endQuiz() {
      // Show thank you message
      document.getElementById('questionContainer').innerHTML = `<p class="text-xl font-semibold">‚úÖ Thank you for completing the quiz!</p>`;
      
      // Send data to Google Sheets
      sendToGoogleSheets();

      console.log("Quiz completed. Participant's score:", totalScore);
    }

    // Send Results to Google Sheets
    function sendToGoogleSheets() {
      const participantName = sessionStorage.getItem('name');
      const participantEmail = sessionStorage.getItem('email');

      const scriptUrl = 'https://script.google.com/macros/s/AKfycbzmcCl7V8Dj6xaCidhjwQIc8be0h8YR_HXQM3NM5329fjB5RjfgQh46hKQQqupCcvSamA/exec';  // Replace with your Apps Script URL

      fetch(scriptUrl, {
        method: 'POST',
        body: new URLSearchParams({
          name: participantName,
          email: participantEmail,
          score: totalScore
        })
      })
      .then(response => response.text())
      .then(result => console.log('Data submitted to Google Sheets:', result))
      .catch(error => console.error('Error submitting data:', error));
    }
  </script>

</body>
</html>
