<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Live Quiz</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">

  <div class="max-w-2xl mx-auto space-y-10">

    <!-- PARTICIPANT SECTION -->
    <div class="bg-white p-6 rounded-xl shadow-md" id="participantSection">
      <h2 class="text-xl font-bold mb-4">üßë‚Äçüéì Participant Panel</h2>

      <!-- Participant's Name and Email -->
      <div id="participantDetails" class="space-y-4 mb-6">
        <input type="text" id="participantName" placeholder="Enter Your Name" class="border rounded px-3 py-2 w-full mb-3" required>
        <input type="email" id="participantEmail" placeholder="Enter Your Email" class="border rounded px-3 py-2 w-full mb-3" required>
        <button onclick="saveParticipantInfo()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full">Start Quiz</button>
      </div>

      <!-- Quiz Section (Hidden until quiz starts) -->
      <div id="quizSection" class="hidden">
        <p class="text-gray-600 mb-4">Waiting for teacher to start the quiz...</p>
        <div id="quizContainer"></div>
      </div>
    </div>

    <!-- TEACHER PANEL (Visible only to teacher) -->
    <div class="bg-white p-6 rounded-xl shadow-md" id="teacherPanel">
      <h2 class="text-xl font-bold mb-4">üë©‚Äçüè´ Teacher Panel</h2>
      <input type="password" id="teacherPass" placeholder="Enter Password" class="border rounded px-3 py-2 w-full mb-3">
      <button onclick="revealLink()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 w-full">Start Quiz</button>
      <p id="linkSection" class="text-sm mt-2 text-blue-600 hidden">
        ‚úÖ Share this link with participants:<br>
        <code id="quizLink" class="bg-blue-100 p-1 rounded block mt-2"></code>
      </p>
    </div>

  </div>

  <script>
    const questions = [
      {
        text: "What is the capital of France?",
        time: 30,
        options: [
          { text: "Paris", marks: 5 },
          { text: "Madrid", marks: 0 },
          { text: "Berlin", marks: 0 },
          { text: "Rome", marks: 0 }
        ]
      },
      {
        text: "2 + 2 = ?",
        time: 30,
        options: [
          { text: "3", marks: 0 },
          { text: "4", marks: 2 },
          { text: "5", marks: 0 },
          { text: "6", marks: 0 }
        ]
      },
      {
        text: "Who wrote '1984'?",
        time: 30,
        options: [
          { text: "George Orwell", marks: 3 },
          { text: "Mark Twain", marks: 0 },
          { text: "Hemingway", marks: 0 },
          { text: "Fitzgerald", marks: 0 }
        ]
      }
    ];

    let currentQuestion = 0;
    let totalScore = 0;
    let timerInterval;

    // Save Participant's Name and Email before starting the quiz
    function saveParticipantInfo() {
      const name = document.getElementById("participantName").value;
      const email = document.getElementById("participantEmail").value;
      if (name && email) {
        document.getElementById("participantDetails").classList.add("hidden");
        document.getElementById("quizSection").classList.remove("hidden");
        showQuestion(currentQuestion);
      } else {
        alert("Please enter both name and email!");
      }
    }

    function showQuestion(index) {
      const q = questions[index];
      const container = document.getElementById("quizContainer");
      container.innerHTML = `
        <h3 class="text-lg font-semibold mb-2">${q.text}</h3>
        <div id="options" class="space-y-2 mb-4"></div>
        <div id="timer" class="text-red-500 font-bold mb-4"></div>
        <button id="nextBtn" disabled class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Next</button>
      `;

      const optionsDiv = document.getElementById("options");
      q.options.forEach((opt, i) => {
        const label = document.createElement("label");
        label.className = "block px-4 py-2 border rounded hover:bg-gray-100 cursor-pointer";
        label.innerHTML = `<input type="radio" name="option" value="${i}" class="mr-2"> ${opt.text}`;
        label.querySelector("input").addEventListener("change", () => {
          document.getElementById("nextBtn").disabled = false;
        });
        optionsDiv.appendChild(label);
      });

      document.getElementById("nextBtn").onclick = submitAnswer;

      let timeLeft = q.time;
      document.getElementById("timer").textContent = `‚è≥ Time left: ${timeLeft}s`;
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById("timer").textContent = `‚è≥ Time left: ${timeLeft}s`;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          submitAnswer(true); // auto-submit
        }
      }, 1000);
    }

    function submitAnswer(auto = false) {
      const selected = document.querySelector('input[name="option"]:checked');
      const selectedIndex = selected ? parseInt(selected.value) : null;
      const q = questions[currentQuestion];
      if (selectedIndex !== null) {
        totalScore += q.options[selectedIndex].marks;
      }
      currentQuestion++;
      if (currentQuestion < questions.length) {
        showQuestion(currentQuestion);
      } else {
        document.getElementById("quizContainer").innerHTML = `<p class="text-xl font-semibold">‚úÖ Thank you for completing the quiz!</p>`;
        
        // Send data to Google Sheets
        sendToGoogleSheets();
        console.log("üîí Final Score (hidden):", totalScore);
      }
    }

    function sendToGoogleSheets() {
      const name = document.getElementById("participantName").value;
      const email = document.getElementById("participantEmail").value;

      // The URL from the Apps Script Web App deployment
      const scriptUrl = "https://script.google.com/macros/s/AKfycbx35IYWKiuz3RePo1Z472xKB2kFNpMNF_wykgon6fyVa9AIdzshj2D2X7VPAVAGrA_v/exec";  // Replace this with your Google Apps Script URL

      // Send POST request with participant data to Google Sheets
      fetch(scriptUrl, {
        method: "POST",
        body: new URLSearchParams({
          name: name,
          email: email,
          score: totalScore
        })
      })
      .then(response => response.text())
      .then(result => console.log("Data submitted to Google Sheets:", result))
      .catch(error => console.error("Error:", error));
    }

    function revealLink() {
      const pass = document.getElementById("teacherPass").value;
      if (pass === "secret123") {
        const url = window.location.href.split("?")[0] + "?start=true";
        document.getElementById("quizLink").textContent = url;
        document.getElementById("linkSection").classList.remove("hidden");
      } else {
        alert("‚ùå Incorrect password!");
      }
    }

    window.onload = () => {
      const params = new URLSearchParams(window.location.search);
      if (params.get("start") === "true") {
        document.getElementById("teacherPanel").classList.add("hidden");
        document.getElementById("quizSection").classList.remove("hidden");
        showQuestion(currentQuestion);
      }
    };
  </script>

</body>
</html>
